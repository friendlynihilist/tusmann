{"version":3,"file":"bindery.min.js","sources":["../src/viewer/error.js","../src/dom-utils/prefixer.js","../src/constants/layout.js","../src/dom-utils/classes.js","../src/dom-utils/createEl.js","../src/dom-utils/safeMeasure.js","../src/dom-utils/index.js","../src/css-length/index.js","../src/page-setup/defaultPageSetup.js","../src/page-setup/PageSetup.js","../src/rules/Rule.js","../src/option-checker/validate.js","../src/option-checker/types.js","../src/rules/Counter.js","../src/rules/OutOfFlow.js","../src/rules/FullBleedSpread.js","../src/rules/FullBleedPage.js","../src/rules/Replace.js","../src/rules/Footnote.js","../src/rules/searchPages.js","../src/utils/shallowEqual.js","../src/utils/throttle.js","../src/rules/PageReference.js","../src/rules/PageBreak.js","../src/rules/RunningHeader.js","../src/rules/Split.js","../src/rules/index.js","../src/defaults/attributeRules.js","../node_modules/regionize/dist/regionize.esm.js","../src/book/Page.js","../src/book/orderPages.js","../src/book/Book.js","../src/book/annotatePages.js","../src/makeBook/dedupeRules.js","../src/makeBook/recoverFromRule.js","../src/makeBook/RuleSet.js","../src/makeBook/estimateProgress.js","../src/makeBook/makeBook.js","../src/layouts/padPages.js","../src/layouts/gridLayout.js","../src/layouts/printMarks.js","../src/layouts/orderPagesBooklet.js","../src/layouts/printLayout.js","../src/layouts/flipLayout.js","../src/viewer/listenForPrint.js","../src/viewer/Viewer.js","../src/constants/modes.js","../src/bindery.js","../src/index.js"],"sourcesContent":["/* global BINDERY_VERSION */\n\nimport { createEl } from '../dom-utils';\n\nexport default function (title, text) {\n  return createEl('.error', [\n    createEl('.error-title', title),\n    createEl('.error-text', text),\n    createEl('.error-footer', `Bindery ${BINDERY_VERSION}`),\n  ]);\n}\n","//\n// prefix classes\nconst p = 'ðŸ“–-';\n\nconst prefix = str => `${p}${str}`;\nconst prefixClass = str => `.${prefix(str)}`;\n\nconst prefixer = (str) => {\n  if (str[0] === '.') {\n    return prefixClass(str.substr(1));\n  }\n  return prefix(str);\n};\n\nexport default prefixer;\n","const PAGES = 1;\nconst SPREADS = 2;\nconst BOOKLET = 3;\n\nexport { PAGES, BOOKLET, SPREADS };\n","import prefix from './prefixer';\nimport { Mode } from '../constants';\n\nconst classes = {\n  showBleed: 'show-bleed',\n  showCrop: 'show-crop',\n  showBleedMarks: 'show-bleed-marks',\n\n  isViewing: 'viewing',\n  viewPreview: 'view-preview',\n  viewPrint: 'view-print',\n  viewFlip: 'view-flip',\n  inProgress: 'in-progress',\n\n  leftPage: 'left',\n  rightPage: 'right',\n  isOverflowing: 'is-overflowing',\n\n  printSheet: 'print-sheet',\n  sheetSpread: 'print-sheet-spread',\n  sheetLeft: 'print-sheet-left',\n  sheetRight: 'print-sheet-right',\n\n  toNext: 'continues',\n  fromPrev: 'continuation',\n};\n\nObject.keys(classes).forEach((k) => {\n  const val = classes[k];\n  classes[k] = prefix(val);\n});\n\nclasses.allModes = [classes.viewPreview, classes.viewPrint, classes.viewFlip];\nclasses[Mode.PREVIEW] = classes.viewPreview;\nclasses[Mode.PRINT] = classes.viewPrint;\nclasses[Mode.FLIPBOOK] = classes.viewFlip;\n\nexport default classes;\n","import prefixer from './prefixer';\n\nconst doc = window.document;\n// Create div with prefixed classes\nconst createEl = (className, content = []) => {\n  const div = doc.createElement('div');\n  div.className = className.split('.').filter(txt => txt !== '').map(prefixer).join(' ');\n\n  if (typeof content === 'string') {\n    div.textContent = content;\n  } else if (Array.isArray(content)) {\n    content.forEach(child => div.appendChild(child));\n  }\n  return div;\n};\n\nexport default createEl;\n","import c from './prefixer';\nimport createEl from './createEl';\n\nconst safeMeasure = (el, measure) => {\n  if (el.parentNode) return measure();\n  let measureArea = document.querySelector(c('.measure-area'));\n  if (!measureArea) measureArea = document.body.appendChild(createEl('measure-area'));\n  if (measureArea.firstElementChild !== el) {\n    measureArea.innerHTML = '';\n    measureArea.appendChild(el);\n  }\n  const result = measure();\n  return result;\n};\n\nexport default safeMeasure;\n","import classes from './classes';\nimport prefixer from './prefixer';\nimport safeMeasure from './safeMeasure';\nimport createEl from './createEl';\n\nconst doc = window.document;\n\n// Create stylesheet with id\nconst addStylesheet = (id) => {\n  const style = doc.createElement('style');\n  style.id = id;\n  doc.head.appendChild(style);\n  return style;\n};\n\n// Fetch or create stylesheet with id\nconst stylesheet = id => doc.querySelector(`#${id}`) || addStylesheet(id);\n\n// Parse html from text\nconst parseHTML = (text, selector) => {\n  const wrapper = doc.createElement('div');\n  wrapper.innerHTML = text;\n  return wrapper.querySelector(selector);\n};\n\nconst c = prefixer;\nexport { c, classes, createEl, stylesheet, safeMeasure, parseHTML };\n","const cssNumberRegEx = /^([+-]?[0-9]+(.?[0-9]+)?)(px|in|cm|mm|pt|pc)$/;\n\nconst isLength = str => cssNumberRegEx.test(str);\n\nconst parseLength = (str) => {\n  if (!isLength(str)) throw Error(`Cannot parse css length from \"${str}\"`);\n\n  const matches = str.match(cssNumberRegEx);\n  return {\n    val: Number(matches[1]),\n    unit: matches[3],\n  };\n};\n\nexport { parseLength, isLength };\n","export default {\n  bleed: '12pt',\n  size: { width: '4in', height: '6in' },\n  margin: {\n    inner: '24pt',\n    outer: '24pt',\n    bottom: '40pt',\n    top: '48pt',\n  },\n};\n","import { stylesheet } from '../dom-utils';\nimport { parseLength } from '../css-length';\n\nimport defaultPageSetup from './defaultPageSetup';\nimport { Paper, Layout } from '../constants';\n\nconst letter = Object.freeze({ width: '8.5in', height: '11in' });\nconst a4 = Object.freeze({ width: '210mm', height: '297mm' });\n\nconst supportsCustomPageSize = !!window.chrome;\n\nclass PageSetup {\n  constructor(opts = {}, printOpts = {}) {\n    this.size = opts.size || defaultPageSetup.size;\n    this.margin = opts.margin || defaultPageSetup.margin;\n    this.markLength = '12pt';\n\n    this.paper = supportsCustomPageSize ? (printOpts.paper || Paper.AUTO) : Paper.AUTO_MARKS;\n    this.bleed = printOpts.bleed || defaultPageSetup.bleed;\n    this.printTwoUp = printOpts.layout && printOpts.layout !== Layout.PAGES;\n  }\n\n  get displaySize() {\n    const width = this.printTwoUp ? this.spreadSize.width : this.size.width;\n    const height = this.size.height;\n    const bleed = this.bleed;\n\n    return { width, height, bleed };\n  }\n\n  get sheetSize() {\n    const width = this.printTwoUp ? this.spreadSize.width : this.size.width;\n    const height = this.size.height;\n\n    const doubleBleed = `2 * ${this.bleed}`;\n    const doubleMarks = `${doubleBleed} + 2 * ${this.markLength}`;\n    const singleMarks = `${this.bleed} + ${this.markLength}`;\n    switch (this.paper) {\n    case Paper.AUTO:\n      return { width, height };\n    case Paper.AUTO_BLEED:\n      return {\n        width: `calc(${width} + ${this.printTwoUp ? doubleBleed : this.bleed})`,\n        height: `calc(${height} + ${doubleBleed})`,\n      };\n    case Paper.AUTO_MARKS:\n      return {\n        width: `calc(${width} + ${this.printTwoUp ? doubleMarks : singleMarks})`,\n        height: `calc(${height} + ${doubleMarks})`,\n      };\n    case Paper.LETTER_LANDSCAPE:\n      return { width: letter.height, height: letter.width };\n    case Paper.LETTER_PORTRAIT:\n      return letter;\n    case Paper.A4_PORTRAIT:\n      return a4;\n    case Paper.A4_LANDSCAPE:\n      return { width: a4.height, height: a4.width };\n    default:\n    }\n    return { width, height };\n  }\n\n  get spreadSize() {\n    const w = parseLength(this.size.width);\n    return {\n      height: this.size.height,\n      width: `${w.val * 2}${w.unit}`,\n    };\n  }\n\n  updateStyleVars() {\n    const page = this.size;\n    const sheet = this.sheetSize;\n    const vars = {\n      'spread-width': this.spreadSize.width,\n      'page-width': page.width,\n      'page-height': page.height,\n      'sheet-width': sheet.width,\n      'sheet-height': sheet.height,\n      'margin-inner': this.margin.inner,\n      'margin-outer': this.margin.outer,\n      'margin-top': this.margin.top,\n      'margin-bottom': this.margin.bottom,\n      bleed: this.bleed,\n      'mark-length': this.markLength,\n    };\n    const str = Object.keys(vars).map(k => `--bindery-${k}: ${vars[k]};`).join('');\n\n    const rootRule = `:root { ${str} }`;\n    const pageRule = `@page { size: ${sheet.width} ${sheet.height}; }`;\n\n    stylesheet('binderyPage').innerHTML = `${rootRule} ${pageRule}`;\n  }\n}\n\nexport default PageSetup;\n","export default class Rule {\n  constructor(options) {\n    this.name = options.name ? options.name : 'Unnamed Bindery Rule';\n    this.selector = '';\n\n    Object.keys(options).forEach((key) => {\n      this[key] = options[key];\n    });\n  }\n}\n","const validate = (opts, validOpts) => {\n  if (!validOpts) throw Error('Valid options not specified');\n\n  Object.keys(opts).forEach((k) => {\n    if (!validOpts[k]) {\n      const setName = validOpts.name ? `'${validOpts.name}'` : 'This option';\n      throw Error(`Unknown option in ${setName}: '${k}'`);\n    }\n    const val = opts[k];\n    const type = validOpts[k];\n    if (!type.check(val)) {\n      const optName = validOpts.name ? `${validOpts.name}.${k}` : k;\n      throw Error(`Invalid value for '${optName}': ${JSON.stringify(val)} is not a ${type.name}.`);\n    }\n  });\n  return true;\n};\n\nexport default validate;\n","import { isLength } from '../css-length';\nimport validate from './validate';\n\nconst isObj = val => typeof val === 'object';\nconst isFunc = val => typeof val === 'function';\nconst isBool = val => typeof val === 'boolean';\nconst isStr = val => typeof val === 'string';\nconst isNum = val => typeof val === 'number';\nconst isArr = val => Array.isArray(val);\n\nconst hasProp = (obj, k) => Object.prototype.hasOwnProperty.call(obj, k);\n\nconst hasSameKeys = (opts, required) => {\n  const keys = Object.keys(required).filter(k => k !== 'name');\n  return !keys.some(k => !hasProp(opts, k));\n};\n\nconst isShape = template => input => isObj(input) && validate(input, template);\n\nconst isShapeExact = template => input => isObj(input)\n  && hasSameKeys(input, template)\n  && validate(input, template);\n\nconst isEnum = cases => str => cases.includes(str);\n\nconst T = {\n  any: {\n    name: 'any',\n    check: () => true,\n  },\n  enum(...cases) {\n    return {\n      name: `(${cases.map(c => `\"${c}\"`).join(' | ')})`,\n      check: isEnum(cases),\n    };\n  },\n  shapeExact: template => ({\n    name: `exactly ({${Object.keys(template).join(', ')}})`,\n    check: isShapeExact(template),\n  }),\n  shape: template => ({\n    name: `shape ({${Object.keys(template).join(', ')}})`,\n    check: isShape(template),\n  }),\n  string: {\n    name: 'string',\n    check: isStr,\n  },\n  length: {\n    name: 'length (string with absolute units)',\n    check: isLength,\n  },\n  number: {\n    name: 'number',\n    check: isNum,\n  },\n  bool: {\n    name: 'bool',\n    check: isBool,\n  },\n  func: {\n    name: 'func',\n    check: isFunc,\n  },\n  obj: {\n    name: 'object',\n    check: isObj,\n  },\n  array: {\n    name: 'array',\n    check: isArr,\n  },\n};\n\nT.margin = {\n  name: 'margin ({ top, inner, outer, bottom })',\n  check: isShapeExact({\n    name: 'margin',\n    top: T.length,\n    inner: T.length,\n    outer: T.length,\n    bottom: T.length,\n  }),\n};\n\nT.size = {\n  name: 'size ({ width, height })',\n  check: isShapeExact({\n    name: 'size',\n    width: T.length,\n    height: T.length,\n  }),\n};\n\nexport default T;\n","import Rule from './Rule';\nimport { validate, T } from '../option-checker';\n\n\nclass Counter extends Rule {\n  constructor(options) {\n    super(options);\n    this.selector = '*';\n    this.counterValue = 0;\n    validate(options, {\n      name: 'Counter',\n      replaceEl: T.string,\n      resetEl: T.string,\n      incrementEl: T.string,\n      replace: T.func,\n    });\n  }\n  setup() {\n    this.counterValue = 0;\n  }\n  beforeAdd(el) {\n    if (el.matches(this.incrementEl)) this.counterValue += 1;\n    if (el.matches(this.resetEl)) this.counterValue = 0;\n    if (el.matches(this.replaceEl)) return this.createReplacement(el);\n    return el;\n  }\n  createReplacement(element) {\n    return this.replace(element, this.counterValue);\n  }\n  replace(element, counterValue) {\n    element.textContent = counterValue;\n    return element;\n  }\n}\n\nexport default Counter;\n","import Rule from './Rule';\n\nclass OutOfFlow extends Rule {\n  constructor(options) {\n    super(options);\n    this.name = 'Out of Flow';\n  }\n  beforeAdd(elmt) {\n    // Avoid breaking inside this element. Once it's completely added,\n    // it will moved onto the background layer.\n\n    elmt.setAttribute('data-ignore-overflow', true);\n    return elmt;\n  }\n  afterAdd(elmt, book, continueOnNewPage, makeNewPage) {\n    this.createOutOfFlowPages(elmt, book, makeNewPage);\n\n    // Catches cases when we didn't need to create a new page. but unclear\n    if (this.continue !== 'same' || book.currentPage.hasOutOfFlowContent) {\n      continueOnNewPage(true);\n      if (this.continue === 'left' || this.continue === 'right') {\n        book.currentPage.setPreference(this.continue);\n      }\n    }\n\n    return elmt;\n  }\n}\n\nexport default OutOfFlow;\n","import OutOfFlow from './OutOfFlow';\nimport { validate, T } from '../option-checker';\nimport { c, createEl } from '../dom-utils';\n\n// Options:\n// selector: String\n\nclass FullBleedSpread extends OutOfFlow {\n  constructor(options) {\n    options.continue = options.continue || 'same';\n    options.rotate = options.rotate || 'none';\n    super(options);\n    validate(options, {\n      name: 'FullBleedSpread',\n      selector: T.string,\n      continue: T.enum('next', 'same', 'left', 'right'),\n      rotate: T.enum('none', 'clockwise', 'counterclockwise'),\n    });\n  }\n  createOutOfFlowPages(elmt, book, makeNewPage) {\n    elmt.parentNode.removeChild(elmt);\n\n    let leftPage;\n    if (book.currentPage.isEmpty) {\n      leftPage = book.currentPage;\n    } else {\n      leftPage = makeNewPage();\n      book.addPage(leftPage);\n    }\n\n    const rightPage = makeNewPage();\n    book.addPage(rightPage);\n\n    if (this.rotate !== 'none') {\n      [leftPage, rightPage].forEach((page) => {\n        const rotateContainer = createEl(`.rotate-container.spread-size-rotated.rotate-spread-${this.rotate}`);\n        rotateContainer.appendChild(page.background);\n        page.element.appendChild(rotateContainer);\n      });\n    }\n\n    leftPage.background.appendChild(elmt);\n    leftPage.element.classList.add(c('spread'));\n    leftPage.setPreference('left');\n    leftPage.isOutOfFlow = this.continue === 'same';\n    leftPage.avoidReorder = true;\n    leftPage.hasOutOfFlowContent = true;\n\n    rightPage.background.appendChild(elmt.cloneNode(true));\n    rightPage.element.classList.add(c('spread'));\n    rightPage.setPreference('right');\n    rightPage.isOutOfFlow = this.continue === 'same';\n    rightPage.avoidReorder = true;\n    rightPage.hasOutOfFlowContent = true;\n  }\n}\n\nexport default FullBleedSpread;\n","import OutOfFlow from './OutOfFlow';\nimport { validate, T } from '../option-checker';\nimport { createEl } from '../dom-utils';\n\n// Options:\n// selector: String\n\nclass FullBleedPage extends OutOfFlow {\n  constructor(options) {\n    options.continue = options.continue || 'same';\n    options.rotate = options.rotate || 'none';\n    super(options);\n    validate(options, {\n      name: 'FullBleedPage',\n      selector: T.string,\n      continue: T.enum('next', 'same', 'left', 'right'),\n      rotate: T.enum('none', 'inward', 'outward', 'clockwise', 'counterclockwise'),\n    });\n  }\n\n  createOutOfFlowPages(elmt, book, makeNewPage) {\n    elmt.parentNode.removeChild(elmt);\n\n    let newPage;\n    if (book.currentPage.isEmpty) {\n      newPage = book.currentPage;\n    } else {\n      newPage = makeNewPage();\n      book.addPage(newPage);\n    }\n    if (this.rotate !== 'none') {\n      const rotateContainer = createEl(`.rotate-container.page-size-rotated.rotate-${this.rotate}`);\n      rotateContainer.appendChild(newPage.background);\n      newPage.element.appendChild(rotateContainer);\n    }\n    newPage.background.appendChild(elmt);\n    newPage.hasOutOfFlowContent = true;\n  }\n}\n\nexport default FullBleedPage;\n","import Rule from './Rule';\n\n// Options:\n// selector: String\n// replace: function (HTMLElement) => HTMLElement\n\nclass Replace extends Rule {\n  constructor(options) {\n    super(options);\n    this.name = 'Replace';\n  }\n  afterAdd(element, book, continueOnNewPage, makeNewPage, overflowCallback) {\n    const parent = element.parentNode;\n    if (!parent) {\n      console.error(element);\n      throw Error(`Bindery.Replace({ selector: '${this.selector}' }).afterAdd called on element that hasn't been added.`);\n    }\n    const defensiveClone = element.cloneNode(true);\n    const replacement = this.createReplacement(book, defensiveClone);\n    parent.replaceChild(replacement, element);\n\n    if (book.currentPage.hasOverflowed()) {\n      parent.replaceChild(element, replacement);\n\n      return overflowCallback(element);\n    }\n\n    return replacement;\n  }\n  createReplacement(book, element) {\n    return this.replace(element);\n  }\n  replace(element) {\n    element.insertAdjacentHTML('beforeEnd', '<sup class=\"bindery-sup\">Default Replacement</sup>');\n    return element;\n  }\n}\n\nexport default Replace;\n","import Replace from './Replace';\nimport { validate, T } from '../option-checker';\nimport { createEl } from '../dom-utils';\n\n// Options:\n// selector: String\n// replace: function (HTMLElement, number) => HTMLElement\n// render: function (Page) => HTMLElement\n\nclass Footnote extends Replace {\n  constructor(options) {\n    super(options);\n    validate(options, {\n      name: 'Footnote',\n      selector: T.string,\n      replace: T.func,\n      render: T.func,\n    });\n  }\n  afterAdd(element, book, continueOnNewPage, makeNewPage, overflowCallback) {\n    const number = book.currentPage.footer.children.length + 1;\n\n    const footnote = createEl('.footnote');\n    const contents = this.render(element, number);\n    if (contents instanceof HTMLElement) footnote.appendChild(contents);\n    else footnote.innerHTML = contents;\n\n    book.currentPage.footer.appendChild(footnote);\n\n    return super.afterAdd(element, book, continueOnNewPage, makeNewPage, (overflowEl) => {\n      book.currentPage.footer.removeChild(footnote);\n      return overflowCallback(overflowEl);\n    });\n  }\n  createReplacement(book, element) {\n    const number = book.currentPage.footer.children.length;\n    return this.replace(element, number);\n  }\n  replace(element, number) {\n    element.insertAdjacentHTML('beforeEnd', `<sup class=\"bindery-sup\">${number}</sup>`);\n    return element;\n  }\n  render(element, number) {\n    return `<sup>${number}</sup> Default footnote (<a href='/bindery/docs/#footnote'>Learn how to change it</a>)`;\n  }\n}\n\nexport default Footnote;\n","const pageNumbersForTest = (pages, test) =>\n  pages.filter(pg => pg.number && test(pg.element)).map(pg => pg.number);\n\nconst pageNumbersForSelector = (pages, sel) =>\n  pageNumbersForTest(pages, el => el.querySelector(sel));\n\nconst formatAsRanges = (pageNumbers) => {\n  let str = '';\n  let prevNum = pageNumbers[0];\n  let isInARange = false;\n\n  const addFirst = (num) => {\n    str += `${num}`;\n  };\n  const continueRange = () => {\n    isInARange = true;\n  };\n  const endRange = (endNum) => {\n    isInARange = false;\n    str += `â€“${endNum}`;\n  };\n  const addComma = (num) => {\n    str += `, ${num}`;\n  };\n  const endAndAdd = (endNum, num) => {\n    endRange(endNum);\n    addComma(num);\n  };\n  const addLast = (num, isAdjacent) => {\n    if (isAdjacent) endRange(num);\n    else if (isInARange && !isAdjacent) endAndAdd(prevNum, num);\n    else addComma(num);\n  };\n\n  pageNumbers.forEach((num, i) => {\n    const isLast = i === pageNumbers.length - 1;\n    const isAdjacent = num === prevNum + 1;\n\n    if (i === 0) addFirst(num);\n    else if (isLast) addLast(num, isAdjacent);\n    else if (isAdjacent) continueRange();\n    else if (isInARange && !isAdjacent) endAndAdd(prevNum, num);\n    else addComma(num);\n    prevNum = num;\n  });\n  return str;\n};\n\nexport { pageNumbersForTest, pageNumbersForSelector, formatAsRanges };\n","// https://github.com/moroshko/shallow-equal/blob/master/src/arrays.js\nconst shallowEqual = (a, b) => {\n  if (a === b) return true;\n  if (!a || !b) return false;\n\n  const len = a.length;\n\n  if (b.length !== len) {\n    return false;\n  }\n\n  for (let i = 0; i < len; i += 1) {\n    if (a[i] !== b[i]) return false;\n  }\n\n  return true;\n};\n\nexport default shallowEqual;\n","const throttleFrame = () => {\n  let wasCalled = false;\n  let queued;\n  const inner = (func) => {\n    if (wasCalled) {\n      queued = func;\n      return;\n    }\n    wasCalled = true;\n    func();\n    requestAnimationFrame(() => {\n      wasCalled = false;\n      if (queued) {\n        const queuedFunc = queued;\n        queued = null;\n        inner(queuedFunc);\n      }\n    });\n  };\n  return inner;\n};\n\nconst throttleTime = (time) => {\n  let wasCalled = false;\n  let queued;\n  const inner = (func) => {\n    if (wasCalled) {\n      queued = func;\n      return;\n    }\n    wasCalled = true;\n    func();\n    setTimeout(() => {\n      wasCalled = false;\n      if (queued) {\n        const queuedFunc = queued;\n        queued = null;\n        inner(queuedFunc);\n      }\n    }, time);\n  };\n  return inner;\n};\n\n\nexport { throttleFrame, throttleTime };\n","import Replace from './Replace';\nimport { pageNumbersForTest, formatAsRanges } from './searchPages';\n\nimport { shallowEqual, throttleTime } from '../utils';\nimport { validate, T } from '../option-checker';\nimport { c } from '../dom-utils';\n\n// Compatible with ids that start with numbers\nconst startsNum = sel => sel.length > 2 && sel[0] === '#' && /^\\d+$/.test(sel[1]);\nconst safeIDSel = sel => (startsNum(sel) ? `[id=\"${sel.replace('#', '')}\"]` : sel);\n\n// Options:\n// selector: String\n// replace: function (HTMLElement, number) => HTMLElement\nclass PageReference extends Replace {\n  constructor(options) {\n    super(options);\n    validate(options, {\n      name: 'PageReference',\n      selector: T.string,\n      replace: T.func,\n      createTest: T.func,\n    });\n    this.references = [];\n    const throttle = throttleTime(10);\n    this.throttledUpdate = (book) => {\n      throttle(() => this.updatePageReferences(book.pages));\n    };\n  }\n\n  eachPage(page, book) {\n    this.throttledUpdate(book);\n  }\n\n  afterAdd(elmt, book) {\n    const test = this.createTest(elmt);\n    if (!test) return elmt;\n\n    const ref = this.createReference(book, test, elmt);\n    return ref.element;\n  }\n\n  createReference(book, test, elmt) {\n    const ref = { test, template: elmt, element: elmt, value: null };\n    const render = newValue => this.render(ref, newValue);\n    ref.render = render;\n    this.references.push(ref);\n    const currentResults = pageNumbersForTest(book.pages, test);\n\n    ref.render(currentResults); // Replace element immediately, to make sure it'll fit\n    return ref;\n  }\n\n  render(ref, newValue) {\n    if (!newValue || shallowEqual(ref.value, newValue)) return;\n    if (!Array.isArray(newValue)) throw Error('Page search returned unexpected result');\n\n    const isResolved = newValue.length > 0;\n    const pageRanges = isResolved ? formatAsRanges(newValue) : 'âŒ§';\n\n    const template = ref.template.cloneNode(true);\n    const newRender = this.replace(template, pageRanges);\n    if (!isResolved) newRender.classList.add(c('placeholder-num'));\n    ref.element.parentNode.replaceChild(newRender, ref.element);\n\n    ref.element = newRender;\n    ref.value = newValue;\n  }\n\n  createTest(element) {\n    const href = element.getAttribute('href');\n    if (!href) return null;\n    const selector = safeIDSel(href);\n    return el => el.querySelector(selector);\n  }\n\n  updatePageReferences(pages) {\n    // querySelector first, then rerender\n    const results = this.references.map(ref =>\n      ({ ref, data: pageNumbersForTest(pages, ref.test) }));\n    results.forEach(({ ref, data }) => this.render(ref, data));\n  }\n\n  replace(template, number) {\n    template.insertAdjacentHTML('beforeend', `, <span>${number}</span>`);\n    return template;\n  }\n}\n\nexport default PageReference;\n","import Rule from './Rule';\nimport { validate, T } from '../option-checker';\n\nclass PageBreak extends Rule {\n  constructor(options) {\n    options.position = options.position || 'before';\n    options.continue = options.continue || 'next';\n    super(options);\n\n    validate(options, {\n      name: 'PageBreak',\n      selector: T.string,\n      continue: T.enum('next', 'left', 'right'),\n      position: T.enum('before', 'after', 'both', 'avoid'),\n    });\n  }\n  get avoidSplit() {\n    return this.position === 'avoid';\n  }\n  beforeAdd(elmt, book, continueOnNewPage) {\n    if (this.position === 'before' || this.position === 'both') {\n      if (!book.currentPage.isEmpty) {\n        continueOnNewPage();\n      }\n      if (this.continue !== 'next') {\n        book.currentPage.setPreference(this.continue);\n      }\n    }\n    return elmt;\n  }\n  afterAdd(elmt, book, continueOnNewPage) {\n    if (this.position === 'after' || this.position === 'both') {\n      const newPage = continueOnNewPage(true);\n      if (this.continue !== 'next') {\n        newPage.setPreference(this.continue);\n      }\n    }\n    return elmt;\n  }\n}\n\nexport default PageBreak;\n","import Rule from './Rule';\nimport { validate, T } from '../option-checker';\nimport { createEl } from '../dom-utils';\n\n// Options:\n// selector: String\n// render: function (Page) => HTMLElement\n// TODO selectorHierarchy: [ String ], ie [ 'h1', 'h2', 'h3.chapter' ]\n\nclass RunningHeader extends Rule {\n  constructor(options = {}) {\n    super(options);\n    validate(options, {\n      name: 'RunningHeader',\n      render: T.func,\n    });\n  }\n  eachPage(page) {\n    if (!page.runningHeader) {\n      const elmt = createEl('.running-header');\n      page.element.appendChild(elmt);\n      page.runningHeader = elmt;\n    }\n    page.runningHeader.innerHTML = this.render(page);\n  }\n  render(page) {\n    return page.number;\n  }\n}\n\nexport default RunningHeader;\n","import Rule from './Rule';\nimport { validate, T } from '../option-checker';\n\nclass Split extends Rule {\n  constructor(options) {\n    super(options);\n\n    validate(options, {\n      name: 'Split',\n      selector: T.string,\n      toNext: T.string,\n      fromPrevious: T.string,\n      didSplit: T.func,\n    });\n  }\n\n  didSplit(original, clone) {\n    if (this.toNext) original.classList.add(this.toNext);\n    if (this.fromPrevious) clone.classList.add(this.fromPrevious);\n  }\n}\n\nexport default Split;\n","import Counter from './Counter';\nimport FullBleedSpread from './FullBleedSpread';\nimport FullBleedPage from './FullBleedPage';\nimport Footnote from './Footnote';\nimport PageReference from './PageReference';\nimport PageBreak from './PageBreak';\nimport RunningHeader from './RunningHeader';\nimport Replace from './Replace';\nimport Rule from './Rule';\nimport Split from './Split';\n\nexport default {\n  Rule,\n  Split(options) {\n    return new Split(options);\n  },\n  Counter(options) {\n    return new Counter(options);\n  },\n  FullBleedPage(options) {\n    return new FullBleedPage(options);\n  },\n  Footnote(options) {\n    return new Footnote(options);\n  },\n  RunningHeader(options) {\n    return new RunningHeader(options);\n  },\n  Replace(options) {\n    return new Replace(options);\n  },\n  FullBleedSpread(options) {\n    return new FullBleedSpread(options);\n  },\n  PageBreak(options) {\n    return new PageBreak(options);\n  },\n  PageReference(options) {\n    return new PageReference(options);\n  },\n  createRule(options) {\n    return new Rule(options);\n  },\n};\n","import rules from '../rules';\n\nconst {\n  PageBreak,\n  PageReference,\n  Footnote,\n  FullBleedPage,\n  FullBleedSpread,\n} = rules;\n\nconst replacer = (element, number) => {\n  element.textContent = `${number}`;\n  return element;\n};\n\nexport default [\n  PageBreak({ selector: '[book-page-break=\"both\"]', position: 'both' }),\n  PageBreak({ selector: '[book-page-break=\"avoid\"]', position: 'avoid' }),\n\n  PageBreak({ selector: '[book-page-break=\"after\"][book-page-continue=\"right\"]', position: 'after', continue: 'right' }),\n  PageBreak({ selector: '[book-page-break=\"after\"][book-page-continue=\"left\"]', position: 'after', continue: 'left' }),\n  PageBreak({ selector: '[book-page-break=\"after\"][book-page-continue=\"next\"]', position: 'after', continue: 'next' }),\n\n  PageBreak({ selector: '[book-page-break=\"before\"][book-page-continue=\"right\"]', position: 'before', continue: 'right' }),\n  PageBreak({ selector: '[book-page-break=\"before\"][book-page-continue=\"left\"]', position: 'before', continue: 'left' }),\n  PageBreak({ selector: '[book-page-break=\"before\"][book-page-continue=\"next\"]', position: 'before', continue: 'next' }),\n\n  FullBleedPage({ selector: '[book-full-bleed=\"page\"]' }),\n  FullBleedSpread({ selector: '[book-full-bleed=\"spread\"]' }),\n\n  Footnote({\n    selector: '[book-footnote-text]',\n    render: (element, number) => {\n      const txt = element.getAttribute('book-footnote-text');\n      return `<i>${number}</i>${txt}`;\n    },\n  }),\n\n  PageReference({\n    selector: '[book-pages-with-text]',\n    replace: replacer,\n    createTest: (element) => {\n      const term = element.getAttribute('book-pages-with-text').toLowerCase().trim();\n      return page => page.textContent.toLowerCase().includes(term);\n    },\n  }),\n\n  PageReference({\n    selector: '[book-pages-with-selector]',\n    replace: replacer,\n    createTest: (element) => {\n      const sel = element.getAttribute('book-pages-with-selector').trim();\n      return page => page.querySelector(sel);\n    },\n  }),\n\n  PageReference({\n    selector: '[book-pages-with]',\n    replace: replacer,\n    createTest: (element) => {\n      const term = element.textContent.toLowerCase().trim();\n      return (page) => {\n        const txt = page.textContent.toLowerCase();\n        return txt.includes(term);\n      };\n    },\n  }),\n];\n","/* ðŸ“– Regionize v0.1.3 */\nconst div = (cls) => {\n  const el = document.createElement('div');\n  el.classList.add(cls);\n  return el;\n};\n\nclass Region {\n  constructor(elmt) {\n    this.element = elmt;\n    this.content = div('region-content');\n    this.content.style.padding = '0.1px';\n    this.content.style.position = 'relative';\n    this.element.appendChild(this.content);\n    this.path = [];\n  }\n\n  setPath(newPath) {\n    this.path = newPath;\n    if (newPath.length > 0) this.content.appendChild(newPath[0]);\n  }\n\n  get currentElement() {\n    const len = this.path.length;\n    if (len > 0) return this.path[len - 1];\n    return this.content;\n  }\n\n  get isEmpty() {\n    return this.content.textContent.trim() === '' && this.content.offsetHeight < 1;\n  }\n\n  get isReasonableSize() {\n    const box = this.element.getBoundingClientRect();\n    return (box.height > 100) && (box.width > 100); // TODO: Number is arbitrary\n  }\n\n  overflowAmount() {\n    const contentH = this.content.offsetHeight;\n    const boxH = this.element.offsetHeight;\n    if (boxH === 0) throw Error('Regionizer: Trying to flow into an element with zero height.');\n    return contentH - boxH;\n  }\n\n  hasOverflowed() {\n    return this.overflowAmount() > -5;\n  }\n}\n\nconst isTextNode = node => node.nodeType === Node.TEXT_NODE;\nconst isElement = node => node.nodeType === Node.ELEMENT_NODE;\nconst isScript = node => node.tagName === 'SCRIPT';\nconst isImage = node => node.tagName === 'IMG';\nconst isUnloadedImage = node => isImage(node) && !node.naturalWidth;\nconst isContentElement = node => isElement(node) && !isScript(node);\n\nconst MAX_TIME = 30; // ms\n\nconst rAF = () => new Promise((resolve) => {\n  requestAnimationFrame(t => resolve(t));\n});\n\nlet lastYieldTime = 0;\n\nconst shouldYield = () => {\n  const timeSinceYield = performance.now() - lastYieldTime;\n  return timeSinceYield > MAX_TIME;\n};\n\nconst yieldIfNecessary = async () => {\n  if (shouldYield()) lastYieldTime = await rAF();\n};\n\nconst overflowAttr = 'data-ignore-overflow';\n// Walk up the tree to see if we are within\n// an overflow-ignoring node\nconst ignoreOverflow = (element) => {\n  if (element.hasAttribute(overflowAttr)) return true;\n  if (element.parentElement) return ignoreOverflow(element.parentElement);\n  return false;\n};\n\nconst createTextNode = (document.createTextNode).bind(document);\n\n// Try adding a text node in one go.\n// Returns true if all the text fits, false if none fits.\nconst addTextNode = async (textNode, parent, hasOverflowed) => {\n  parent.appendChild(textNode);\n  const success = !hasOverflowed();\n  if (!success) parent.removeChild(textNode);\n  await yieldIfNecessary();\n  return success;\n};\n\n\n// Try adding a text node by incrementally adding words\n// until it just barely doesnt overflow.\n//\n// Returns true if all the text fits, false if none fits,\n// or new textnode containing the remainder text.\nconst addTextNodeUntilOverflow = async (textNode, parent, hasOverflowed) => {\n  const originalText = textNode.nodeValue;\n  parent.appendChild(textNode);\n\n  if (!hasOverflowed() || ignoreOverflow(parent)) {\n    return true;\n  }\n\n  // Add letter by letter until overflow\n  let pos = 0;\n  textNode.nodeValue = originalText.substr(0, pos);\n\n  while (!hasOverflowed() && pos < originalText.length) {\n    // advance to next non-space character\n    pos += 1;\n    while (pos < originalText.length && originalText.charAt(pos) !== ' ') pos += 1;\n\n    if (pos < originalText.length) {\n      // reveal more text\n      textNode.nodeValue = originalText.substr(0, pos);\n      await yieldIfNecessary();\n    }\n  }\n\n  // Back out to word boundary\n  if (originalText.charAt(pos) === ' ') pos -= 1; // TODO: redundant\n  while (originalText.charAt(pos) !== ' ' && pos > 0) pos -= 1;\n\n  if (pos < 1) {\n    // We didn't even add a complete word, don't add node\n    textNode.nodeValue = originalText;\n    parent.removeChild(textNode);\n    return false; // TODO\n  }\n\n  // trim text to word\n  const fittingText = originalText.substr(0, pos);\n  const overflowingText = originalText.substr(pos);\n  textNode.nodeValue = fittingText;\n\n  // Create a new text node for the next flow box\n  const remainingTextNode = createTextNode(overflowingText);\n  return remainingTextNode;\n};\n\n\n// Fills text across multiple elements by requesting a continuation\n// once the current element overflows\nconst addTextNodeAcrossParents = async (textNode, parent, nextParent, hasOverflowed) => {\n  const result = await addTextNodeUntilOverflow(textNode, parent, hasOverflowed);\n  if (isTextNode(result)) {\n    const nextElement = nextParent();\n    return addTextNodeAcrossParents(result, nextElement, nextParent, hasOverflowed);\n  }\n  return result;\n};\n\n// Shifts this element to the next page. If any of its\n// ancestors cannot be split across page, it will\n// step up the tree to find the first ancestor\n// that can be split, and move all of that descendants\n// to the next page.\nconst tryInNextRegion = (region, makeNextRegion, canSplit) => {\n  if (region.path.length <= 1) {\n    throw Error('Regionize: Attempting to move the top-level element');\n  }\n  const startLength = region.path.length;\n\n  // So this node won't get cloned. TODO: this is unclear\n  const elementToMove = region.path.pop();\n\n  // find the nearest splittable parent\n  let nearestElementThatCanBeMoved = elementToMove;\n  const pathToRestore = [];\n  while (region.path.length > 1 && !canSplit(region.currentElement)) {\n    nearestElementThatCanBeMoved = region.path.pop();\n    pathToRestore.unshift(nearestElementThatCanBeMoved);\n  }\n\n  // Once a node is moved to a new page, it should no longer trigger another\n  // move. otherwise tall elements will endlessly get shifted to the next page\n  nearestElementThatCanBeMoved.setAttribute('data-bindery-did-move', true);\n\n  const parent = nearestElementThatCanBeMoved.parentNode;\n  parent.removeChild(nearestElementThatCanBeMoved);\n\n  // If the nearest ancestor would be empty without this node,\n  // move it to the next page too.\n  if (region.path.length > 1 && region.currentElement.textContent.trim() === '') {\n    parent.appendChild(nearestElementThatCanBeMoved);\n    nearestElementThatCanBeMoved = region.path.pop();\n    pathToRestore.unshift(nearestElementThatCanBeMoved);\n    nearestElementThatCanBeMoved.parentNode.removeChild(nearestElementThatCanBeMoved);\n  }\n\n  let nextRegion;\n  if (!region.isEmpty) {\n    if (region.hasOverflowed()) {\n      // Recovery failed, maybe the box contains a large\n      // unsplittable element.\n      region.suppressErrors = true;\n    }\n    nextRegion = makeNextRegion();\n  } else {\n    // If the page is empty when this node is removed,\n    // then it won't help to move it to the next page.\n    // Instead continue here until the node is done.\n    nextRegion = region;\n  }\n\n  // append moved node as first in new page\n  nextRegion.currentElement.appendChild(nearestElementThatCanBeMoved);\n\n  // restore subpath\n  pathToRestore.forEach(r => nextRegion.path.push(r));\n  nextRegion.path.push(elementToMove);\n\n  if (startLength !== nextRegion.path.length) {\n    throw Error('Regionize: Restored path depth does not match original path depth');\n  }\n};\n\n// The path is an array of nested elments,\n// for example .content > article > p > a).\n//\n// It's shallowly cloned every time we move to the next page,\n// to create the illusion that nodes are continuing from page\n// to page.\n//\n// The transition can be customized by setting a Split rule,\n// which lets you add classes to the original and cloned element\n// to customize styling.\n\nconst clonePath = (oldPath, applyRules) => {\n  const newPath = [];\n\n  const deepClone = (el) => {\n    const clone = el.cloneNode(true); // deep clone, could be th > h3 > span;\n    applyRules(el, clone);\n    return clone;\n  };\n\n  for (let i = oldPath.length - 1; i >= 0; i -= 1) {\n    const original = oldPath[i];\n    const clone = original.cloneNode(false); // shallow\n    const nextChild = oldPath[i + 1];\n    clone.innerHTML = '';\n\n    applyRules(original, clone, nextChild, deepClone);\n\n    if (i < oldPath.length - 1) clone.appendChild(newPath[i + 1]);\n    newPath[i] = clone;\n  }\n\n  return newPath;\n};\n\n// Polls every 10ms for image.naturalWidth\n// or an error event.\n//\n// Note: Doesn't ever reject, since missing images\n// shouldn't prevent layout from resolving\n\nconst wait10 = () => new Promise((resolve) => {\n  setTimeout(() => { resolve(); }, 10);\n});\n\nconst ensureImageLoaded = async (image) => {\n  const imgStart = performance.now();\n  let failed = false;\n  image.addEventListener('error', () => { failed = true; });\n  image.src = image.src; // re-trigger error if already failed\n\n  while (!image.naturalWidth && !failed) {\n    await wait10();\n  }\n\n  return performance.now() - imgStart;\n};\n\nconst preserveNumbering = (original, clone, nextChild) => {\n  // restart numbering\n  let prevStart = 1;\n  if (original.hasAttribute('start')) {\n    // the OL is also a continuation\n    prevStart = parseInt(original.getAttribute('start'), 10);\n  }\n  if (nextChild && nextChild.tagName === 'LI') {\n    // the first list item is a continuation\n    prevStart -= 1;\n  }\n  const prevCount = original.children.length;\n  const newStart = prevStart + prevCount;\n  clone.setAttribute('start', newStart);\n};\n\nconst preserveTableColumns = (original, clone, nextChild, deepClone) => {\n  const columns = [...original.children];\n\n  const currentIndex = columns.indexOf(nextChild);\n  for (let i = 0; i < currentIndex; i += 1) {\n    const clonedCol = deepClone(columns[i]);\n    clone.appendChild(clonedCol);\n  }\n};\n\nconst noop = () => {};\nconst always = () => true;\nconst never = () => false;\n\n// flow content through FlowBoxes.\n// This function is not book-specific,\n// the caller is responsible for managing\n// and creating boxes.\nconst flowIntoRegions = async (opts) => {\n  // required options\n  const content = opts.content;\n  const createRegion = opts.createRegion;\n  if (!content) throw Error('content not specified');\n  if (!createRegion) throw Error('createRegion not specified');\n\n  // optional\n  const applySplit = opts.applySplit || noop;\n  const canSplit = opts.canSplit || always;\n  const beforeAdd = opts.beforeAdd || noop;\n  const afterAdd = opts.afterAdd || noop;\n  const didWaitFor = opts.didWaitFor || noop;\n  const shouldTraverse = opts.shouldTraverse || never;\n\n  // ____\n  // Begin\n  let currentRegion = createRegion();\n  const hasOverflowed = () => currentRegion.hasOverflowed();\n  const canSplitCurrent = () => canSplit(currentRegion.currentElement);\n  const ignoreCurrentOverflow = () => ignoreOverflow(currentRegion.currentElement);\n\n  const splitRules = (prev, clone, next, deepClone) => {\n    if (prev.tagName === 'OL') preserveNumbering(prev, clone, next, deepClone);\n    if (prev.tagName === 'TR') preserveTableColumns(prev, clone, next, deepClone);\n    applySplit(prev, clone, next, deepClone);\n  };\n\n  const continueInNextRegion = () => {\n    const oldBox = currentRegion;\n    currentRegion = createRegion();\n\n    const newPath = clonePath(oldBox.path, splitRules);\n    currentRegion.setPath(newPath);\n    return currentRegion;\n  };\n\n  const continuedParent = () => {\n    continueInNextRegion();\n    return currentRegion.currentElement;\n  };\n\n  const addTextWithoutChecks = (textNode, parent) => {\n    parent.appendChild(textNode);\n    if (!ignoreCurrentOverflow() && canSplitCurrent()) {\n      currentRegion.suppressErrors = true;\n      continueInNextRegion();\n    }\n  };\n\n  const addSplittableTextNode = async (textNode) => {\n    const el = currentRegion.currentElement;\n    let hasAdded = await addTextNodeAcrossParents(textNode, el, continuedParent, hasOverflowed);\n    if (!hasAdded && currentRegion.path.length > 1) {\n      // retry 1\n      tryInNextRegion(currentRegion, continueInNextRegion, canSplit);\n      hasAdded = await addTextNodeAcrossParents(textNode, el, continuedParent, hasOverflowed);\n    }\n    if (!hasAdded) {\n      // retry 2\n      addTextWithoutChecks(textNode, currentRegion.currentElement);\n    }\n  };\n\n  const addWholeTextNode = async (textNode) => {\n    let hasAdded = await addTextNode(textNode, currentRegion.currentElement, hasOverflowed);\n    if (!hasAdded && !ignoreCurrentOverflow()) {\n      // retry 1\n      tryInNextRegion(currentRegion, continueInNextRegion, canSplit);\n      hasAdded = await addTextNode(textNode, currentRegion.currentElement, hasOverflowed);\n    }\n    if (!hasAdded) {\n      // retry 2\n      addTextWithoutChecks(textNode, currentRegion.currentElement);\n    }\n  };\n\n  // No need to traverse every node if fifts AND\n  // none of the contents could change size.\n  // Images and custom rules could cause the size to change\n  const canSkipTraversal = (element) => {\n    const containsImage = element.querySelector('img');\n    return !containsImage && !shouldTraverse(element);\n  };\n\n  let safeAddElementNode;\n\n  // Adds an element node by clearing its childNodes, then inserting them\n  // one by one recursively until they overflow the region\n  const addElementNode = async (element) => {\n    // Insert element\n    currentRegion.currentElement.appendChild(element);\n    currentRegion.path.push(element);\n\n    if (canSkipTraversal(element)) {\n      // console.log('maybe short circuit');\n      if (!hasOverflowed()) {\n        // console.log('did short circuit');\n        return currentRegion.path.pop();\n      }\n    }\n\n    // Clear element\n    const childNodes = [...element.childNodes];\n    element.innerHTML = '';\n\n    // Overflows when empty\n    if (hasOverflowed() && !ignoreCurrentOverflow() && canSplitCurrent()) {\n      tryInNextRegion(currentRegion, continueInNextRegion, canSplit);\n    }\n\n    const shouldSplit = canSplit(element) && !ignoreOverflow(element);\n\n    for (const child of childNodes) {\n      if (isTextNode(child)) {\n        await (shouldSplit ? addSplittableTextNode : addWholeTextNode)(child);\n      } else if (isContentElement(child)) {\n        await safeAddElementNode(child);\n      }\n    }\n    return currentRegion.path.pop();\n  };\n\n  safeAddElementNode = async (element) => {\n    // Ensure images are loaded before measuring\n    if (isUnloadedImage(element)) {\n      const waitTime = await ensureImageLoaded(element);\n      didWaitFor(waitTime);\n    }\n\n    // Transforms before adding\n    beforeAdd(element, continueInNextRegion);\n\n    const addedElement = await addElementNode(element);\n\n    // Transforms after adding\n    afterAdd(addedElement, continueInNextRegion);\n  };\n\n  return safeAddElementNode(content);\n};\n\nexport { Region, flowIntoRegions };\n","import { Region } from 'regionize';\nimport { safeMeasure, createEl, classes } from '../dom-utils';\n\nclass Page {\n  constructor() {\n    this.flow = new Region(createEl('flow-box'));\n    this.footer = createEl('footer');\n    this.background = createEl('page-background');\n    this.element = createEl('page', [this.background, this.flow.element, this.footer]);\n  }\n\n  static isSizeValid() {\n    const testPage = new Page();\n    return safeMeasure(testPage.element, () => testPage.flow.isReasonableSize);\n  }\n\n  setLeftRight(dir) {\n    this.side = dir;\n    this.element.classList.toggle(classes.leftPage, this.isLeft);\n    this.element.classList.toggle(classes.rightPage, !this.isLeft);\n  }\n  get isLeft() {\n    return this.side === 'left';\n  }\n\n  get isRight() {\n    return this.side === 'right';\n  }\n\n  setPreference(dir) {\n    const preferLeft = dir === 'left';\n    this.alwaysLeft = preferLeft;\n    this.alwaysRight = !preferLeft;\n  }\n\n  get suppressErrors() {\n    return this.suppress || false;\n  }\n\n  set suppressErrors(newVal) {\n    this.suppress = newVal;\n    this.element.classList.toggle(classes.isOverflowing, newVal);\n  }\n\n  get isEmpty() {\n    return !this.hasOutOfFlowContent && this.flow.isEmpty;\n  }\n\n  validate() {\n    if (!this.hasOverflowed()) return;\n    const suspect = this.currentElement;\n    if (suspect) {\n      console.warn('Bindery: Content overflows, probably due to a style set on:', suspect);\n      suspect.parentNode.removeChild(suspect);\n    } else {\n      console.warn('Bindery: Content overflows.');\n    }\n  }\n\n  validateEnd(allowOverflow) {\n    if (!this.hasOverflowed()) return;\n    console.warn(`Bindery: Page ~${this.number} is overflowing`, this.element);\n    if (!this.suppressErrors && !this.flow.suppressErrors && !allowOverflow) {\n      throw Error('Bindery: Moved to new page when last one is still overflowing');\n    }\n  }\n\n  hasOverflowed() {\n    return safeMeasure(this.element, () => this.flow.hasOverflowed());\n  }\n}\n\nexport default Page;\n","const indexOfNextReorderablePage = (pages, startIndex) => {\n  for (let i = startIndex; i < pages.length; i += 1) {\n    const pg = pages[i];\n    if (!pg.isOutOfFlow && !pg.avoidReorder) return i;\n  }\n  return null;\n};\n\n// Given an array of pages with alwaysLeft, alwaysRight, and isOutOfFlow\n// properties, orders them so that alwaysLeft and alwaysRight are true.\n\nconst orderPages = (pages, makeNewPage) => {\n  const orderedPages = pages.slice();\n\n  for (let i = 0; i < orderedPages.length; i += 1) {\n    const page = orderedPages[i];\n    const isLeft = i % 2 !== 0;\n\n    if ((isLeft && page.alwaysRight) || (!isLeft && page.alwaysLeft)) {\n      if (page.isOutOfFlow) {\n        // If the page is 'out of flow', we'd prefer not to add a blank page.\n        // Instead it floats backwards in the book, pulling the next\n        // in-flow page forward. If several 'out of flow' pages\n        // are next to each other, they will remain in order, all being pushed\n        // backward together.\n\n        const indexToSwap = indexOfNextReorderablePage(orderedPages, i + 1);\n        if (!indexToSwap) {\n          // No larger index to swap with, perhaps because\n          // we are optimistically rendering before the book is done\n          break;\n        }\n        const pageToMoveUp = orderedPages[indexToSwap];\n        orderedPages.splice(indexToSwap, 1); // remove pg\n        orderedPages.splice(i, 0, pageToMoveUp); // insert pg\n      } else {\n        // If the page is 'in flow', order must be respected, so extra blank pages\n        // are inserted.\n        orderedPages.splice(i, 0, makeNewPage());\n      }\n    }\n  }\n  return orderedPages;\n};\n\nexport default orderPages;\n","import Page from './Page';\nimport orderPages from './orderPages';\n\nconst MAXIMUM_PAGE_LIMIT = 2000;\n\nclass Book {\n  constructor() {\n    this.rawPages = [];\n    this.orderedPages = [];\n  }\n\n  addPage(newPage) {\n    this.rawPages.push(newPage);\n    this.updatePageOrder();\n  }\n\n  get pageCount() {\n    return this.orderedPages.length;\n  }\n\n  get pages() {\n    return this.orderedPages;\n  }\n\n  updatePageOrder() {\n    this.orderedPages = orderPages(this.rawPages, () => new Page());\n  }\n\n  validate() {\n    if (this.pageCount > MAXIMUM_PAGE_LIMIT) {\n      throw Error('Bindery: Maximum page count exceeded. Suspected runaway layout.');\n    }\n  }\n}\n\nexport default Book;\n","const annotatePages = (pages, offset) => {\n  // â€”â€”â€”\n  // NUMBERING\n\n  // TODO: Pass in facingpages options\n  const facingPages = true;\n  if (facingPages) {\n    pages.forEach((page, i) => {\n      page.number = offset + i + 1;\n      page.setLeftRight((i % 2 === 0) ? 'right' : 'left');\n    });\n  } else {\n    pages.forEach((page) => { page.setLeftRight('right'); });\n  }\n\n  // â€”â€”â€”\n  // RUNNING HEADERS\n\n  // Sections to annotate with.\n  // This should be a hierarchical list of selectors.\n  // Every time one is selected, it annotates all following pages\n  // and clears any subselectors.\n  // TODO: Make this configurable\n  const running = { h1: '', h2: '', h3: '', h4: '', h5: '', h6: '' };\n\n  pages.forEach((page) => {\n    page.heading = {};\n    Object.keys(running).forEach((tagName, i) => {\n      const element = page.element.querySelector(tagName);\n      if (element) {\n        running[tagName] = element.textContent;\n        // clear remainder\n        Object.keys(running).forEach((tag, j) => {\n          if (j > i) running[tag] = '';\n        });\n      }\n      if (running[tagName] !== '') {\n        page.heading[tagName] = running[tagName];\n      }\n    });\n  });\n};\n\nexport default annotatePages;\n","import FullBleedPage from '../rules/FullBleedPage';\nimport FullBleedSpread from '../rules/FullBleedSpread';\nimport PageBreak from '../rules/PageBreak';\n\nconst isSpread = rule => rule instanceof FullBleedSpread;\nconst isPage = rule => rule instanceof FullBleedPage;\nconst isBreak = rule => rule instanceof PageBreak;\n\nconst isFullPageRule = rule => isSpread(rule) || isPage(rule) || isBreak(rule);\n\nconst dedupe = (inputRules) => {\n  const conflictRules = inputRules.filter(isFullPageRule);\n  const output = inputRules.filter(rule => !conflictRules.includes(rule));\n\n  const firstSpreadRule = conflictRules.find(isSpread);\n  const firstPageRule = conflictRules.find(isPage);\n\n  // Only apply one fullpage or fullspread\n  if (firstSpreadRule) output.push(firstSpreadRule);\n  else if (firstPageRule) output.push(firstPageRule);\n  else output.push(...conflictRules); // but multiple pagebreaks are ok\n\n  return output;\n};\n\nexport default dedupe;\n","// TODO:\n// While this does catch overflows, it is pretty hacky to move the entire node to the next page.\n// - 1. there is no guarentee it will fit on the new page\n// - 2. if it had childNodes, those side effects will not be undone,\n// which means footnotes will get left on previous page.\n// - 3. if it is a large paragraph, it will leave a large gap. the\n// ideal approach would be to only need to invalidate the last line of text.\nconst recoverFromRule = (el, book, nextBox) => {\n  let removed = el;\n  const parent = el.parentNode;\n  parent.removeChild(removed);\n  let popped;\n  if (book.currentPage.hasOverflowed()) {\n    parent.appendChild(el);\n    removed = parent;\n    removed.parentNode.removeChild(removed);\n    popped = book.currentPage.flow.path.pop();\n    if (book.currentPage.hasOverflowed()) {\n      console.error('Trying again didnt fix it');\n    } else {\n      // Trying again worked\n    }\n  }\n  const newBox = nextBox();\n  newBox.currentElement.appendChild(removed);\n  if (popped) newBox.path.push(popped);\n};\n\n\nexport default recoverFromRule;\n","import { classes } from '../dom-utils';\nimport dedupe from './dedupeRules';\nimport recoverFromRule from './recoverFromRule';\n\nconst giveUp = (rule, el) => {\n  console.warn(`Couldn't apply ${rule.name}, caused overflows twice when adding: `, el);\n};\n\nclass RuleSet {\n  constructor(rules) {\n    const offsetRule = rules.find(r => r.pageNumberOffset);\n    this.pageNumberOffset = offsetRule ? offsetRule.pageNumberOffset : 0;\n\n    // Rules for pages\n    this.pageRules = rules.filter(r => r.eachPage);\n\n    // Rules for elements\n    this.beforeAddRules = rules.filter(r => r.selector && r.beforeAdd);\n    this.afterAddRules = rules.filter(r => r.selector && r.afterAdd);\n\n    // Rules for layout\n    this.selectorsNotToSplit = rules.filter(r => r.avoidSplit).map(r => r.selector);\n    this.didSplitRules = rules.filter(r => r.selector && r.didSplit);\n\n    // setup\n    rules.filter(r => r.setup).forEach(r => r.setup());\n\n    this.applySplitRules = this.applySplitRules.bind(this);\n\n    const allSelectors = rules.map(r => r.selector).filter(sel => !!sel).join(', ');\n    if (allSelectors) {\n      const shouldTraverse = el => el.querySelector(allSelectors);\n      this.shouldTraverse = shouldTraverse.bind(this);\n    } else {\n      this.shouldTraverse = () => false;\n    }\n  }\n\n  applySplitRules(original, clone, nextChild, deepClone) {\n    original.classList.add(classes.toNext);\n    clone.classList.add(classes.fromPrev);\n\n    this.didSplitRules.filter(r => original.matches(r.selector)).forEach((rule) => {\n      rule.didSplit(original, clone, nextChild, deepClone);\n    });\n  }\n\n  // Rules for pages\n  applyPageDoneRules(pg, book) {\n    this.pageRules.forEach(rule => rule.eachPage(pg, book));\n  }\n  finishEveryPage(book) {\n    this.pageRules.forEach(rule => book.pages.forEach(pg => rule.eachPage(pg, book)));\n  }\n\n  // Rules for elements\n  applyBeforeAddRules(element, book, continueOnNewPage, makeNewPage) {\n    let addedElement = element;\n\n    const matchingRules = this.beforeAddRules.filter(rule => addedElement.matches(rule.selector));\n\n    matchingRules.forEach((rule) => {\n      addedElement = rule.beforeAdd(addedElement, book, continueOnNewPage, makeNewPage);\n    });\n    return addedElement;\n  }\n\n  applyAfterAddRules(originalElement, book, continueOnNewPage, makeNewPage) {\n    let addedElement = originalElement;\n\n    const attemptRecovery = el => recoverFromRule(el, book, continueOnNewPage);\n    const matchingRules = this.afterAddRules.filter(rule => addedElement.matches(rule.selector));\n    const uniqueRules = dedupe(matchingRules);\n\n    uniqueRules.forEach((rule) => {\n      const retry = (el) => {\n        attemptRecovery(el);\n        return rule.afterAdd(el, book, continueOnNewPage, makeNewPage, () => giveUp(rule, el));\n      };\n      addedElement = rule.afterAdd(addedElement, book, continueOnNewPage, makeNewPage, retry);\n    });\n    return addedElement;\n  }\n}\n\nexport default RuleSet;\n","const sec = ms => (ms / 1000).toFixed(2);\n\nconst estimateFor = (content) => {\n  const start = window.performance.now();\n  const capacity = content.querySelectorAll('*').length;\n  let timeWaiting = 0;\n  let completed = 0;\n\n  return {\n    increment: () => { completed += 1; },\n    addWaitTime: (t) => { timeWaiting += t; },\n    get progress() { return completed / capacity; },\n    end: () => {\n      const end = window.performance.now();\n      const total = end - start;\n      const layout = total - timeWaiting;\n      console.log(`ðŸ“– Layout ready in ${sec(layout)}s (plus ${sec(timeWaiting)}s waiting for images)`);\n    },\n  };\n};\n\nexport default estimateFor;\n","import { flowIntoRegions } from 'regionize';\nimport { Book, Page, annotatePages } from '../book';\n\n// paginate\nimport RuleSet from './RuleSet';\nimport estimateFor from './estimateProgress';\n\nconst makeBook = async (content, rules, updateProgress) => {\n  if (!Page.isSizeValid()) throw Error('Page is too small');\n\n  const estimator = estimateFor(content);\n  const ruleSet = new RuleSet(rules);\n  const book = new Book();\n  const pageNumberOffset = ruleSet.pageNumberOffset;\n\n  const makeNewPage = () => new Page();\n\n  const finishPage = (page, allowOverflow) => {\n    // finished with this page, can display\n    book.updatePageOrder();\n    annotatePages(book.pages, pageNumberOffset);\n    ruleSet.applyPageDoneRules(page, book);\n    page.validateEnd(allowOverflow);\n    book.validate();\n  };\n\n  const addPageToBook = (allowOverflow = false) => {\n    const oldPage = book.currentPage;\n    if (oldPage) finishPage(oldPage, allowOverflow);\n\n    const newPage = makeNewPage();\n    book.currentPage = newPage;\n    book.addPage(newPage);\n\n    updateProgress(book, estimator.progress);\n    newPage.validate();\n    return newPage;\n  };\n\n  const makeNextRegion = () => {\n    const newPage = addPageToBook();\n    return newPage.flow;\n  };\n\n  const applySplit = ruleSet.applySplitRules;\n  const dontSplitSel = ruleSet.selectorsNotToSplit;\n  const canSplit = (element) => {\n    if (dontSplitSel.some(sel => element.matches(sel))) {\n      return false;\n    }\n    if (element.parentElement) return canSplit(element.parentElement, dontSplitSel);\n    return true;\n  };\n\n  const beforeAdd = (elementToAdd, continueInNextRegion) => {\n    ruleSet.applyBeforeAddRules(elementToAdd, book, continueInNextRegion, makeNewPage);\n  };\n\n  const afterAdd = (addedElement, continueInNextRegion) => {\n    estimator.increment();\n    return ruleSet.applyAfterAddRules(addedElement, book, continueInNextRegion, makeNewPage);\n  };\n\n  // init\n  content.style.margin = 0;\n  content.style.padding = 0;\n\n  await flowIntoRegions({\n    content,\n    createRegion: makeNextRegion,\n    applySplit,\n    canSplit,\n    beforeAdd,\n    afterAdd,\n    shouldTraverse: ruleSet.shouldTraverse,\n    didWaitFor: t => estimator.addWaitTime(t),\n  });\n\n  book.updatePageOrder();\n  annotatePages(book.pages, pageNumberOffset);\n\n  ruleSet.finishEveryPage(book);\n  estimator.end();\n  return book;\n};\n\n\nexport default makeBook;\n","const padPages = (pages, makePage) => {\n  if (pages.length % 2 !== 0) {\n    const pg = makePage();\n    pages.push(pg);\n  }\n  const spacerPage = makePage();\n  const spacerPage2 = makePage();\n  spacerPage.element.style.visibility = 'hidden';\n  spacerPage2.element.style.visibility = 'hidden';\n  pages.unshift(spacerPage);\n  pages.push(spacerPage2);\n\n  return pages;\n};\n\nexport default padPages;\n","import { Page } from '../book';\nimport { createEl } from '../dom-utils';\nimport padPages from './padPages';\n\nconst twoPageSpread = children => createEl('.spread-wrapper.spread-centered.spread-size', children);\nconst onePageSpread = children => createEl('.spread-wrapper.spread-centered.page-size', children);\n\nconst renderGridLayout = (bookPages, isTwoUp) => {\n  const pages = isTwoUp ? padPages(bookPages, () => new Page()) : bookPages;\n\n  const gridLayout = document.createDocumentFragment();\n  if (isTwoUp) {\n    for (let i = 0; i < pages.length; i += 2) {\n      const wrap = twoPageSpread([pages[i].element, pages[i + 1].element]);\n      gridLayout.appendChild(wrap);\n    }\n  } else {\n    pages.forEach((pg) => {\n      const wrap = onePageSpread([pg.element]);\n      gridLayout.appendChild(wrap);\n    });\n  }\n\n  return gridLayout;\n};\n\nexport default renderGridLayout;\n","import { createEl } from '../dom-utils';\n\nconst directions = ['top', 'bottom', 'left', 'right'];\nconst bleedMarks = () => directions.map(dir => createEl(`.mark-bleed-${dir}`));\nconst cropMarks = () => directions.map(dir => createEl(`.mark-crop-${dir}`));\n\nconst printMarksSingle = () => createEl('.page-size.print-mark-wrap', [\n  ...cropMarks(), ...bleedMarks(),\n]);\n\nconst printMarksSpread = () => createEl('.spread-size.print-mark-wrap', [\n  createEl('.mark-crop-fold'), ...cropMarks(), ...bleedMarks(),\n]);\n\nconst bookletMeta = (i, len) => {\n  const isFront = i % 4 === 0;\n  const sheetIndex = parseInt((i + 1) / 4, 10) + 1;\n  return createEl('.print-meta', `Sheet ${sheetIndex} of ${len / 4}: ${isFront ? 'Outside' : 'Inside'}`);\n};\n\nexport {\n  printMarksSingle,\n  printMarksSpread,\n  bookletMeta,\n};\n","const orderPagesBooklet = (pages, makePage) => {\n  while (pages.length % 4 !== 0) {\n    const spacerPage = makePage();\n    spacerPage.element.style.visibility = 'hidden';\n    pages.push(spacerPage);\n  }\n  const bookletOrder = [];\n  const len = pages.length;\n\n  for (let i = 0; i < len / 2; i += 2) {\n    bookletOrder.push(pages[len - 1 - i]);\n    bookletOrder.push(pages[i]);\n    bookletOrder.push(pages[i + 1]);\n    bookletOrder.push(pages[len - 2 - i]);\n  }\n\n  return bookletOrder;\n};\n\nexport default orderPagesBooklet;\n","import { createEl, classes } from '../dom-utils';\nimport { Page } from '../book';\nimport { Layout } from '../constants';\n\nimport { printMarksSingle, printMarksSpread, bookletMeta } from './printMarks';\nimport padPages from './padPages';\nimport orderPagesBooklet from './orderPagesBooklet';\n\nconst twoPageSpread = children => createEl('.spread-wrapper', children);\nconst onePageSpread = children => createEl('.spread-wrapper', children);\n\nconst renderPrintLayout = (bookPages, doubleSided, layout) => {\n  const isTwoUp = layout !== Layout.PAGES;\n  const isSpreads = layout === Layout.SPREADS;\n  const isBooklet = layout === Layout.BOOKLET;\n\n  let pages = bookPages;\n  if (isSpreads) pages = padPages(pages, () => new Page());\n  else if (isBooklet) pages = orderPagesBooklet(pages, () => new Page());\n\n  const printLayout = document.createDocumentFragment();\n\n  const marks = isTwoUp ? printMarksSpread : printMarksSingle;\n  const spread = isTwoUp ? twoPageSpread : onePageSpread;\n\n  const printSheet = children => createEl('print-sheet', [spread(children)]);\n\n  if (isTwoUp) {\n    for (let i = 0; i < pages.length; i += 2) {\n      const spreadMarks = marks();\n      if (isBooklet) {\n        const meta = bookletMeta(i, pages.length);\n        spreadMarks.appendChild(meta);\n      }\n      const sheet = printSheet([\n        createEl('.page-bleed-clip.page-bleed-clip-left', [pages[i].element]),\n        createEl('.page-bleed-clip.page-bleed-clip-right', [pages[i + 1].element]),\n        spreadMarks]);\n      sheet.classList.add(classes.sheetSpread);\n      printLayout.appendChild(sheet);\n    }\n  } else {\n    pages.forEach((pg) => {\n      const sheet = printSheet([pg.element, marks()]);\n      sheet.classList.add(pg.isLeft ? classes.sheetLeft : classes.sheetRight);\n      printLayout.appendChild(sheet);\n    });\n  }\n\n  return printLayout;\n};\n\nexport default renderPrintLayout;\n","import { Page } from '../book';\nimport { c, createEl } from '../dom-utils';\nimport padPages from './padPages';\n\nconst renderFlipLayout = (bookPages, doubleSided) => {\n  const pages = padPages(bookPages, () => new Page());\n\n  const flipLayout = document.createDocumentFragment();\n  const sizer = createEl('.spread-size.flip-sizer');\n  const flapHolder = createEl('.spread-size.flap-holder');\n  sizer.appendChild(flapHolder);\n  flipLayout.appendChild(sizer);\n  const flaps = [];\n  let currentLeaf = -1;\n\n  let leftOffset = 4;\n  if (pages.length * leftOffset > 60) {\n    leftOffset = 60 / pages.length;\n  }\n  flapHolder.style.width = `${pages.length * leftOffset}px`;\n\n  const setLeaf = (n) => {\n    let newLeaf = n;\n    if (newLeaf === currentLeaf) newLeaf += 1;\n    currentLeaf = newLeaf;\n\n    let zScale = 4;\n    if (flaps.length * zScale > 200) zScale = 200 / flaps.length;\n\n    flaps.forEach((flap, i, arr) => {\n      // + 0.5 so left and right are even\n      const z = (arr.length - Math.abs((i - newLeaf) + 0.5)) * zScale;\n      flap.style.transform = `translate3d(${(i < newLeaf) ? 4 : 0}px,0,${z}px) rotateY(${(i < newLeaf) ? -180 : 0}deg)`;\n    });\n  };\n\n  let leafIndex = 0;\n  for (let i = 1; i < pages.length - 1; i += (doubleSided ? 2 : 1)) {\n    leafIndex += 1;\n    const li = leafIndex;\n    const flap = createEl('.page3d');\n    flap.addEventListener('click', () => {\n      const newLeaf = li - 1;\n      setLeaf(newLeaf);\n    });\n\n    const rightPage = pages[i].element;\n    let leftPage;\n    rightPage.classList.add(c('page3d-front'));\n    flap.appendChild(rightPage);\n    if (doubleSided) {\n      flap.classList.add(c('doubleSided'));\n      leftPage = pages[i + 1].element;\n    } else {\n      leftPage = createEl('.page');\n    }\n    leftPage.classList.add(c('page3d-back'));\n    flap.appendChild(leftPage);\n\n    // TODO: Dynamically add/remove pages.\n    // Putting 1000s of elements onscreen\n    // locks up the browser.\n\n    flap.style.left = `${i * leftOffset}px`;\n\n    flaps.push(flap);\n    flapHolder.appendChild(flap);\n  }\n\n  setLeaf(0);\n  return flipLayout;\n};\n\nexport default renderFlipLayout;\n","const isCommandP = e => (e.ctrlKey || e.metaKey) && e.keyCode === 80;\n\n// Automatically switch into print mode\nconst listenForPrint = (beforePrint) => {\n  if (window.matchMedia) {\n    const mediaQueryList = window.matchMedia('print');\n    mediaQueryList.addListener((mql) => {\n      if (mql.matches) {\n        // before print\n        beforePrint();\n      } else {\n        // after print\n      }\n    });\n  }\n  document.body.addEventListener('keydown', (e) => {\n    if (isCommandP(e)) {\n      e.preventDefault();\n      beforePrint();\n      setTimeout(() => window.print(), 200);\n    }\n  });\n};\n\nexport default listenForPrint;\n","import { Page } from '../book';\nimport { Mode, Paper, Layout, Marks } from '../constants';\nimport { classes, createEl } from '../dom-utils';\nimport { throttleFrame, throttleTime } from '../utils';\nimport { gridLayout, printLayout, flipLayout } from '../layouts';\n\nimport errorView from './error';\nimport listenForPrint from './listenForPrint';\n\nconst throttleProgressBar = throttleFrame();\nconst throttleRender = throttleTime(100);\nconst throttleResize = throttleTime(50);\nconst document = window.document;\n\nclass Viewer {\n  constructor({ pageSetup, mode, layout, marks, ControlsComponent }) {\n    this.book = null;\n    this.pageSetup = pageSetup;\n\n    this.progressBar = createEl('progress-bar');\n    this.content = createEl('zoom-content');\n    this.scaler = createEl('zoom-scaler', [this.content]);\n    this.element = createEl('root', [this.progressBar, this.scaler]);\n\n    this.doubleSided = true;\n    this.layout = layout;\n\n    this.setMarks(marks);\n    this.mode = mode;\n    this.element.classList.add(classes.viewPreview);\n    this.currentLeaf = 0;\n\n    listenForPrint(() => {\n      this.mode = Mode.PRINT;\n      this.render();\n    });\n\n    window.addEventListener('resize', () => {\n      throttleResize(() => this.scaleToFit());\n    });\n\n    if (ControlsComponent) {\n      this.controls = new ControlsComponent(\n        { Mode, Paper, Layout, Marks }, // Available options\n        { // Initial props\n          paper: this.pageSetup.paper,\n          layout: this.layout,\n          mode: this.mode,\n          marks,\n        },\n        { // Actions\n          setMode: this.setMode.bind(this),\n          setPaper: this.setSheetSize.bind(this),\n          setLayout: this.setLayout.bind(this),\n          setMarks: this.setMarks.bind(this),\n          getPageSize: () => this.pageSetup.displaySize,\n        }\n      );\n      this.element.appendChild(this.controls.element);\n    }\n\n    this.inProgress = true;\n\n    this.show();\n  }\n\n  setMode(newVal) {\n    const newMode = parseInt(newVal, 10);\n    if (newMode === this.mode) return;\n    this.mode = newMode;\n    this.render();\n  }\n\n  get inProgress() {\n    return this.element.classList.contains(classes.inProgress);\n  }\n  set inProgress(newVal) {\n    this.element.classList.toggle(classes.inProgress, newVal);\n    if (newVal && this.controls) this.controls.setInProgress();\n  }\n\n  get isTwoUp() {\n    return this.layout !== Layout.PAGES;\n  }\n\n  get isShowingCropMarks() {\n    return this.element.classList.contains(classes.showCrop);\n  }\n  set isShowingCropMarks(newVal) {\n    this.element.classList.toggle(classes.showCrop, newVal);\n  }\n\n  get isShowingBleedMarks() {\n    return this.element.classList.contains(classes.showBleedMarks);\n  }\n  set isShowingBleedMarks(newVal) {\n    this.element.classList.toggle(classes.showBleedMarks, newVal);\n  }\n\n  get isShowingBleed() {\n    return this.element.classList.contains(classes.showBleed);\n  }\n  set isShowingBleed(newVal) {\n    this.element.classList.toggle(classes.showBleed, newVal);\n  }\n\n  get isViewing() {\n    return document.body.classList.contains(classes.isViewing);\n  }\n  set isViewing(newVal) {\n    document.body.classList.toggle(classes.isViewing, newVal);\n  }\n\n  setSheetSize(str) {\n    const newVal = parseInt(str, 10);\n\n    this.pageSetup.paper = newVal;\n    this.pageSetup.updateStyleVars();\n\n    this.mode = Mode.PRINT;\n    this.render();\n\n    this.scaleToFit();\n    setTimeout(() => { this.scaleToFit(); }, 300);\n  }\n\n  setLayout(str) {\n    const newVal = parseInt(str, 10);\n\n    if (newVal === this.layout) return;\n    this.layout = newVal;\n\n    this.pageSetup.printTwoUp = this.isTwoUp;\n    this.pageSetup.updateStyleVars();\n\n    this.mode = Mode.PRINT;\n    this.render();\n  }\n\n  setMarks(str) {\n    const newVal = parseInt(str, 10);\n    this.isShowingCropMarks = (newVal === Marks.CROP || newVal === Marks.BOTH);\n    this.isShowingBleedMarks = (newVal === Marks.BLEED || newVal === Marks.BOTH);\n  }\n\n  displayError(title, text) {\n    this.show();\n    if (!this.error) {\n      this.error = errorView(title, text);\n      this.element.appendChild(this.error);\n      this.scrollToBottom();\n      if (this.book) {\n        const flow = this.book.currentPage.flow;\n        if (flow) flow.currentElement.style.outline = '3px solid red';\n      }\n    }\n  }\n  scrollToBottom() {\n    const scroll = document.scrollingElement;\n    if (!scroll) return;\n    const scrollMax = scroll.scrollHeight - scroll.offsetHeight;\n    scroll.scrollTop = scrollMax;\n  }\n  clear() {\n    this.book = null;\n    this.lastSpreadInProgress = null; // TODO: Make this clearer, after first render\n    this.content.innerHTML = '';\n  }\n  show() {\n    if (this.element.parentNode) return;\n    document.body.appendChild(this.element);\n    this.isViewing = true;\n  }\n  hide() {\n    // TODO this doesn't work if the target is an existing node\n    if (!this.element.parentNode) return;\n    this.element.parentNode.removeChild(this.element);\n    this.isViewing = false;\n  }\n  render(newBook) {\n    if (newBook) this.book = newBook;\n    if (!this.book) return;\n    this.show();\n\n    this.element.classList.remove(...classes.allModes);\n    this.element.classList.add(classes[this.mode]);\n    this.isShowingBleed = this.mode === Mode.PRINT;\n\n    const prevScroll = this.scrollPercent;\n\n    if (this.controls) this.controls.setDone(this.book.pages.length);\n    this.progress = 1;\n\n    window.requestAnimationFrame(() => {\n      const pages = this.book.pages.slice();\n      const fragment = this.viewFor(this.mode)(pages, this.doubleSided, this.layout);\n      this.content.innerHTML = '';\n      this.content.appendChild(fragment);\n      if (!this.hasRendered) this.hasRendered = true;\n      else this.scrollPercent = prevScroll;\n\n      this.scaleToFit();\n    });\n  }\n\n  viewFor(mode) {\n    if (mode === Mode.PREVIEW) return gridLayout;\n    else if (mode === Mode.FLIPBOOK) return flipLayout;\n    else if (mode === Mode.PRINT) return printLayout;\n    throw Error(`Invalid layout mode: ${this.mode} (type ${typeof this.mode})`);\n  }\n\n  set progress(p) {\n    if (p < 1) {\n      throttleProgressBar(() => {\n        this.progressBar.style.transform = `scaleX(${p})`;\n      });\n    } else {\n      this.progressBar.style.transform = '';\n    }\n  }\n  updateProgress(book, estimatedProgress) {\n    this.book = book;\n    this.progress = estimatedProgress;\n\n    if (!document || !document.scrollingElement) return;\n    // don't rerender if preview is out of view\n    const scrollTop = document.scrollingElement.scrollTop;\n    const scrollH = document.scrollingElement.scrollHeight;\n    const h = document.scrollingElement.offsetHeight;\n    if (scrollH > h * 3 && scrollTop < h) return;\n\n    // don't rerender too often\n    throttleRender(() => this.renderProgress(book, estimatedProgress));\n  }\n\n  renderProgress(book, estimatedProgress) {\n    const needsZoomUpdate = !this.content.firstElementChild;\n\n    if (this.controls) {\n      this.controls.updateProgress(book.pageCount, estimatedProgress);\n    }\n\n    const sideBySide =\n      this.mode === Mode.PREVIEW\n      || (this.mode === Mode.PRINT && this.layout !== Layout.PAGES);\n    const limit = sideBySide ? 2 : 1;\n\n    const makeSpread = pgs => createEl('.spread-wrapper.spread-centered.spread-size', pgs);\n\n    book.pages.forEach((page, i) => {\n      if (this.content.contains(page.element) && page.element.parentNode !== this.content) return;\n      if (this.lastSpreadInProgress && this.lastSpreadInProgress.children.length < limit) {\n        this.lastSpreadInProgress.appendChild(page.element);\n        return;\n      }\n      this.lastSpreadInProgress = makeSpread([page.element]);\n      if (i === 0 && sideBySide) {\n        const spacer = new Page();\n        spacer.element.style.visibility = 'hidden';\n        this.lastSpreadInProgress.insertBefore(\n          spacer.element,\n          this.lastSpreadInProgress.firstElementChild\n        );\n      }\n      this.content.appendChild(this.lastSpreadInProgress);\n    });\n\n    if (needsZoomUpdate) this.scaleToFit();\n  }\n\n  scaleToFit() {\n    if (!this.content.firstElementChild) return;\n    const prevScroll = this.scrollPercent;\n    this.scaler.style.transform = `scale(${this.scaleThatFits})`;\n    this.scrollPercent = prevScroll;\n  }\n\n  get scaleThatFits() {\n    const viewerW = this.scaler.getBoundingClientRect().width;\n    const contentW = this.content.getBoundingClientRect().width;\n    return Math.min(1, viewerW / contentW);\n  }\n\n  get scrollPercent() {\n    if (!document || !document.scrollingElement) return 0;\n    const el = document.scrollingElement;\n    return el.scrollTop / el.scrollHeight;\n  }\n\n  set scrollPercent(newVal) {\n    if (!document || !document.scrollingElement) return;\n    const el = document.scrollingElement;\n    el.scrollTop = el.scrollHeight * newVal;\n  }\n}\n\nexport default Viewer;\n","const FLIPBOOK = 1;\nconst PREVIEW = 2;\nconst PRINT = 3;\n\nexport { FLIPBOOK, PREVIEW, PRINT };\n","/* global BINDERY_VERSION */\n\n// main\nimport PageSetup from './page-setup';\nimport { Mode, Paper, Layout, Marks } from './constants';\nimport defaultRules from './defaults';\n\n// components\nimport makeBook from './makeBook';\nimport Viewer from './viewer';\nimport rules from './rules';\nimport { validate, T } from './option-checker';\nimport { parseHTML } from './dom-utils';\n\nconst vals = obj => Object.keys(obj).map(k => obj[k]);\nconst rAF = () => new Promise((resolve) => {\n  requestAnimationFrame(t => resolve(t));\n});\n\nclass Bindery {\n  constructor(opts = {}) {\n    console.log(`ðŸ“– Bindery ${BINDERY_VERSION}`);\n\n    if (!opts.content) {\n      this.viewer.displayError('Content not specified', 'You must include a source element, selector, or url');\n      throw Error('Bindery: You must include a source element or selector');\n    }\n\n    this.autorun = opts.autorun || true;\n    this.autoupdate = opts.autoupdate || false;\n\n    validate(opts, {\n      name: 'makeBook',\n      autorun: T.bool,\n      content: T.any,\n      ControlsComponent: T.func,\n      view: T.enum(...vals(Mode)),\n      pageNumberOffset: T.number,\n      pageSetup: T.shape({\n        name: 'pageSetup',\n        margin: T.margin,\n        size: T.size,\n      }),\n      printSetup: T.shape({\n        name: 'printSetup',\n        bleed: T.length,\n        layout: T.enum(...vals(Layout)),\n        marks: T.enum(...vals(Marks)),\n        paper: T.enum(...vals(Paper)),\n      }),\n      rules: T.array,\n    });\n\n    this.pageSetup = new PageSetup(opts.pageSetup, opts.printSetup);\n\n    const startLayout = opts.printSetup ? opts.printSetup.layout || Layout.PAGES : Layout.PAGES;\n    const startMarks = opts.printSetup ? opts.printSetup.marks || Marks.CROP : Marks.CROP;\n    const controls = opts.ControlsComponent || window.BinderyControls;\n    this.viewer = new Viewer({\n      pageSetup: this.pageSetup,\n      mode: opts.view || Mode.PREVIEW,\n      marks: startMarks,\n      layout: startLayout,\n      ControlsComponent: controls,\n    });\n\n    this.rules = defaultRules;\n    this.rules.push({ pageNumberOffset: opts.pageNumberOffset || 0 });\n    if (opts.rules) this.addRules(opts.rules);\n\n    this.getContentAsElement(opts.content).then((el) => {\n      this.content = el;\n      if (el && this.autorun) this.makeBook();\n    });\n  }\n\n  // Convenience constructor\n  static makeBook(opts = {}) {\n    opts.autorun = opts.autorun ? opts.autorun : true;\n    return new Bindery(opts);\n  }\n\n  async getContentAsElement(content) {\n    if (content instanceof HTMLElement) return content;\n    if (typeof content === 'string') {\n      const el = document.querySelector(content);\n      if (!(el instanceof HTMLElement)) {\n        this.viewer.displayError('Content not specified', `Could not find element that matches selector \"${content}\"`);\n        console.error(`Bindery: Could not find element that matches selector \"${content}\"`);\n      }\n      return el;\n    }\n    if (typeof content === 'object' && content.url) {\n      return this.fetchContent(content.url, content.selector);\n    }\n    throw Error('Bindery: Source must be an element or selector');\n  }\n\n  async fetchContent(url, sel) {\n    const response = await fetch(url);\n    if (response.status !== 200) {\n      this.viewer.displayError(response.status, `Could not find file at \"${url}\"`);\n      throw Error(`Bindery: Could not find file at \"${url}\"`);\n    }\n    const fetchedContent = await response.text();\n    const el = parseHTML(fetchedContent, sel);\n    if (!(el instanceof HTMLElement)) {\n      this.viewer.displayError(\n        'Source not specified',\n        `Could not find element that matches selector \"${sel}\"`\n      );\n      throw Error(`Bindery: Could not find element that matches selector \"${sel}\"`);\n    }\n    return el;\n  }\n\n  cancel() {\n    this.viewer.hide();\n    if (this.content) this.content.style.display = '';\n  }\n\n  addRules(newRules) {\n    newRules.forEach((rule) => {\n      if (rule instanceof rules.Rule) {\n        this.rules.push(rule);\n      } else {\n        throw Error(`Bindery: The following is not an instance of Bindery.Rule and will be ignored: ${rule}`);\n      }\n    });\n  }\n\n  async makeBook() {\n    if (!this.content) {\n      this.viewer.show();\n      console.error('No content');\n      return null;\n    }\n\n    this.content.style.display = '';\n    const content = this.content.cloneNode(true);\n    this.content.style.display = 'none';\n\n    this.layoutInProgress = true;\n    this.viewer.clear(); // In case we're updating an existing layout\n    this.viewer.show();\n    this.pageSetup.updateStyleVars();\n    this.viewer.inProgress = true;\n\n    try {\n      const onProgress = (current, progress) => this.viewer.updateProgress(current, progress);\n      const book = await makeBook(content, this.rules, onProgress);\n      this.viewer.progress = 1;\n      this.layoutInProgress = false;\n      await rAF();\n      this.viewer.render(book);\n      this.viewer.inProgress = false;\n      return book;\n    } catch (e) {\n      this.layoutInProgress = false;\n      this.viewer.inProgress = false;\n      this.viewer.displayError('Layout couldn\\'t complete', e.message);\n      console.error(e);\n      return null;\n    }\n  }\n}\n\nexport default Bindery;\n","/* global BINDERY_VERSION */\nimport Bindery from './bindery';\nimport rules from './rules';\nimport { Mode, Paper, Layout, Marks } from './constants';\nimport './main.scss';\n\n\nconst BinderyWithRules = Object.assign(Bindery, rules);\nBinderyWithRules.View = Mode;\nBinderyWithRules.Paper = Paper;\nBinderyWithRules.Layout = Layout;\nBinderyWithRules.Marks = Marks;\nBinderyWithRules.version = BINDERY_VERSION;\n\nexport default BinderyWithRules;\n"],"names":["title","text","createEl","BINDERY_VERSION","prefix","str","prefixClass","prefixer","substr","PAGES","classes","showBleed","showCrop","showBleedMarks","isViewing","viewPreview","viewPrint","viewFlip","inProgress","leftPage","rightPage","isOverflowing","printSheet","sheetSpread","sheetLeft","sheetRight","toNext","fromPrev","Object","keys","forEach","k","val","allModes","doc","window","document","className","content","div","createElement","split","filter","txt","map","join","textContent","Array","isArray","child","appendChild","safeMeasure","el","measure","parentNode","measureArea","querySelector","c","body","firstElementChild","innerHTML","result","addStylesheet","id","style","head","stylesheet","parseHTML","selector","wrapper","cssNumberRegEx","isLength","test","parseLength","Error","matches","match","unit","bleed","size","width","height","margin","inner","outer","bottom","top","letter","freeze","a4","supportsCustomPageSize","chrome","PageSetup","constructor","opts","printOpts","defaultPageSetup","markLength","paper","printTwoUp","layout","Layout.PAGES","displaySize","spreadSize","sheetSize","doubleBleed","doubleMarks","singleMarks","w","updateStyleVars","page","sheet","vars","rootRule","pageRule","Rule","options","name","key","validate","validOpts","setName","type","check","optName","JSON","stringify","isObj","hasProp","obj","prototype","hasOwnProperty","call","hasSameKeys","required","some","isShape","template","input","isShapeExact","isEnum","cases","includes","T","any","enum","shapeExact","shape","string","length","number","bool","func","array","Counter","counterValue","replaceEl","resetEl","incrementEl","replace","setup","beforeAdd","createReplacement","element","OutOfFlow","elmt","setAttribute","afterAdd","book","continueOnNewPage","makeNewPage","createOutOfFlowPages","continue","currentPage","hasOutOfFlowContent","setPreference","FullBleedSpread","rotate","removeChild","isEmpty","addPage","rotateContainer","background","classList","add","isOutOfFlow","avoidReorder","cloneNode","FullBleedPage","newPage","Replace","overflowCallback","parent","console","error","defensiveClone","replacement","replaceChild","hasOverflowed","insertAdjacentHTML","Footnote","render","footer","children","footnote","contents","HTMLElement","overflowEl","pageNumbersForTest","pages","pg","formatAsRanges","pageNumbers","prevNum","isInARange","addFirst","num","continueRange","endRange","endNum","addComma","endAndAdd","addLast","isAdjacent","i","isLast","shallowEqual","a","b","len","throttleTime","time","queued","wasCalled","setTimeout","queuedFunc","startsNum","sel","safeIDSel","PageReference","createTest","references","throttle","throttledUpdate","updatePageReferences","eachPage","ref","createReference","value","newValue","push","currentResults","isResolved","pageRanges","newRender","href","getAttribute","results","data","PageBreak","position","avoidSplit","RunningHeader","runningHeader","Split","fromPrevious","didSplit","original","clone","createRule","rules","replacer","term","toLowerCase","trim","cls","Region","padding","path","setPath","newPath","currentElement","offsetHeight","isReasonableSize","box","getBoundingClientRect","overflowAmount","contentH","boxH","isTextNode","node","nodeType","Node","TEXT_NODE","isElement","ELEMENT_NODE","isScript","tagName","isImage","isUnloadedImage","naturalWidth","isContentElement","rAF","Promise","resolve","requestAnimationFrame","t","lastYieldTime","shouldYield","timeSinceYield","performance","now","yieldIfNecessary","ignoreOverflow","hasAttribute","parentElement","createTextNode","bind","addTextNode","textNode","success","addTextNodeUntilOverflow","originalText","nodeValue","pos","charAt","fittingText","overflowingText","remainingTextNode","addTextNodeAcrossParents","nextParent","nextElement","tryInNextRegion","region","makeNextRegion","canSplit","startLength","elementToMove","pop","nearestElementThatCanBeMoved","pathToRestore","unshift","nextRegion","suppressErrors","r","clonePath","oldPath","applyRules","deepClone","nextChild","wait10","ensureImageLoaded","image","imgStart","failed","addEventListener","src","preserveNumbering","prevStart","parseInt","prevCount","newStart","preserveTableColumns","columns","currentIndex","indexOf","clonedCol","noop","always","never","flowIntoRegions","createRegion","applySplit","didWaitFor","shouldTraverse","currentRegion","canSplitCurrent","ignoreCurrentOverflow","splitRules","prev","next","continueInNextRegion","oldBox","continuedParent","addTextWithoutChecks","addSplittableTextNode","hasAdded","addWholeTextNode","canSkipTraversal","containsImage","safeAddElementNode","addElementNode","childNodes","shouldSplit","waitTime","addedElement","Page","flow","isSizeValid","testPage","setLeftRight","dir","side","toggle","isLeft","isRight","preferLeft","alwaysLeft","alwaysRight","suppress","newVal","suspect","warn","validateEnd","allowOverflow","indexOfNextReorderablePage","startIndex","orderPages","orderedPages","slice","indexToSwap","pageToMoveUp","splice","Book","rawPages","updatePageOrder","pageCount","annotatePages","offset","running","h1","h2","h3","h4","h5","h6","heading","tag","j","isSpread","rule","isPage","isBreak","isFullPageRule","dedupe","inputRules","conflictRules","output","firstSpreadRule","find","firstPageRule","recoverFromRule","nextBox","removed","popped","newBox","giveUp","RuleSet","offsetRule","pageNumberOffset","pageRules","beforeAddRules","afterAddRules","selectorsNotToSplit","didSplitRules","applySplitRules","allSelectors","applyPageDoneRules","finishEveryPage","applyBeforeAddRules","matchingRules","applyAfterAddRules","originalElement","attemptRecovery","uniqueRules","sec","ms","toFixed","estimateFor","start","capacity","querySelectorAll","timeWaiting","completed","increment","addWaitTime","progress","end","log","makeBook","updateProgress","estimator","ruleSet","finishPage","addPageToBook","oldPage","dontSplitSel","elementToAdd","padPages","makePage","spacerPage","spacerPage2","visibility","twoPageSpread","onePageSpread","renderGridLayout","bookPages","isTwoUp","gridLayout","createDocumentFragment","wrap","directions","bleedMarks","cropMarks","printMarksSingle","printMarksSpread","bookletMeta","sheetIndex","orderPagesBooklet","bookletOrder","renderPrintLayout","doubleSided","isBooklet","printLayout","marks","spread","spreadMarks","meta","renderFlipLayout","flipLayout","sizer","flapHolder","flaps","currentLeaf","leftOffset","setLeaf","n","newLeaf","zScale","flap","arr","z","Math","abs","transform","leafIndex","li","left","isCommandP","e","ctrlKey","metaKey","keyCode","listenForPrint","beforePrint","matchMedia","mediaQueryList","addListener","mql","preventDefault","print","throttleProgressBar","throttleRender","throttleResize","Viewer","pageSetup","mode","ControlsComponent","progressBar","scaler","setMarks","scaleToFit","controls","Mode","Paper","Layout","Marks","setMode","setPaper","setSheetSize","setLayout","getPageSize","show","newMode","contains","setInProgress","isShowingCropMarks","isShowingBleedMarks","isShowingBleed","displayError","errorView","scrollToBottom","outline","scroll","scrollingElement","scrollMax","scrollHeight","scrollTop","clear","lastSpreadInProgress","hide","newBook","remove","prevScroll","scrollPercent","setDone","fragment","viewFor","hasRendered","p","estimatedProgress","scrollH","h","renderProgress","needsZoomUpdate","sideBySide","limit","makeSpread","pgs","spacer","insertBefore","scaleThatFits","viewerW","contentW","min","vals","Bindery","viewer","autorun","autoupdate","view","printSetup","startLayout","startMarks","BinderyControls","defaultRules","addRules","getContentAsElement","then","url","fetchContent","response","fetch","status","fetchedContent","cancel","display","newRules","layoutInProgress","current","message","BinderyWithRules","assign","View","version"],"mappings":"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"}