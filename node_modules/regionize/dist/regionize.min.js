/* ðŸ“– Regionize v0.1.3 */var Regionize=function(a){'use strict';const b=a=>{const b=document.createElement('div');return b.classList.add(a),b};class c{constructor(a){this.element=a,this.content=b('region-content'),this.content.style.padding='0.1px',this.content.style.position='relative',this.element.appendChild(this.content),this.path=[]}setPath(a){this.path=a,0<a.length&&this.content.appendChild(a[0])}get currentElement(){const a=this.path.length;return 0<a?this.path[a-1]:this.content}get isEmpty(){return''===this.content.textContent.trim()&&1>this.content.offsetHeight}get isReasonableSize(){const a=this.element.getBoundingClientRect();return 100<a.height&&100<a.width}overflowAmount(){const a=this.content.offsetHeight,b=this.element.offsetHeight;if(0===b)throw Error('Regionizer: Trying to flow into an element with zero height.');return a-b}hasOverflowed(){return-5<this.overflowAmount()}}const d=a=>a.nodeType===Node.TEXT_NODE,e=a=>a.nodeType===Node.ELEMENT_NODE,f=a=>'SCRIPT'===a.tagName,g=a=>'IMG'===a.tagName,h=a=>g(a)&&!a.naturalWidth,i=a=>e(a)&&!f(a),j=()=>new Promise(a=>{requestAnimationFrame(b=>a(b))});let k=0;const l=()=>{const a=performance.now()-k;return 30<a},m=async()=>{l()&&(k=await j())},n=a=>!!a.hasAttribute('data-ignore-overflow')||!!a.parentElement&&n(a.parentElement),o=document.createTextNode.bind(document),p=async(a,b,c)=>{b.appendChild(a);const d=!c();return d||b.removeChild(a),await m(),d},q=async(a,b,c)=>{const d=a.nodeValue;if(b.appendChild(a),!c()||n(b))return!0;let e=0;for(a.nodeValue=d.substr(0,e);!c()&&e<d.length;){for(e+=1;e<d.length&&' '!==d.charAt(e);)e+=1;e<d.length&&(a.nodeValue=d.substr(0,e),await m())}for(' '===d.charAt(e)&&(e-=1);' '!==d.charAt(e)&&0<e;)e-=1;if(1>e)return a.nodeValue=d,b.removeChild(a),!1;const f=d.substr(0,e),g=d.substr(e);a.nodeValue=f;const h=o(g);return h},r=async(a,b,c,e)=>{const f=await q(a,b,e);if(d(f)){const a=c();return r(f,a,c,e)}return f},s=(a,b,c)=>{if(1>=a.path.length)throw Error('Regionize: Attempting to move the top-level element');const d=a.path.length,e=a.path.pop();let f=e;const g=[];for(;1<a.path.length&&!c(a.currentElement);)f=a.path.pop(),g.unshift(f);f.setAttribute('data-bindery-did-move',!0);const h=f.parentNode;h.removeChild(f),1<a.path.length&&''===a.currentElement.textContent.trim()&&(h.appendChild(f),f=a.path.pop(),g.unshift(f),f.parentNode.removeChild(f));let i;if(a.isEmpty?i=a:(a.hasOverflowed()&&(a.suppressErrors=!0),i=b()),i.currentElement.appendChild(f),g.forEach(a=>i.path.push(a)),i.path.push(e),d!==i.path.length)throw Error('Regionize: Restored path depth does not match original path depth')},t=(a,b)=>{const c=[],d=a=>{const c=a.cloneNode(!0);return b(a,c),c};for(let e=a.length-1;0<=e;e-=1){const f=a[e],g=f.cloneNode(!1),h=a[e+1];g.innerHTML='',b(f,g,h,d),e<a.length-1&&g.appendChild(c[e+1]),c[e]=g}return c},u=()=>new Promise(a=>{setTimeout(()=>{a()},10)}),v=async a=>{const b=performance.now();let c=!1;for(a.addEventListener('error',()=>{c=!0}),a.src=a.src;!a.naturalWidth&&!c;)await u();return performance.now()-b},w=(a,b,c)=>{let d=1;a.hasAttribute('start')&&(d=parseInt(a.getAttribute('start'),10)),c&&'LI'===c.tagName&&(d-=1);const e=a.children.length,f=d+e;b.setAttribute('start',f)},x=(a,b,c,d)=>{const e=[...a.children],f=e.indexOf(c);for(let g=0;g<f;g+=1){const a=d(e[g]);b.appendChild(a)}},y=()=>{},z=()=>!0,A=()=>!1;return a.Region=c,a.flowIntoRegions=async a=>{const b=a.content,c=a.createRegion;if(!b)throw Error('content not specified');if(!c)throw Error('createRegion not specified');const e=a.applySplit||y,f=a.canSplit||z,g=a.beforeAdd||y,j=a.afterAdd||y,k=a.didWaitFor||y,l=a.shouldTraverse||A;let m=c();const o=()=>m.hasOverflowed(),q=()=>f(m.currentElement),u=()=>n(m.currentElement),B=(a,b,c,d)=>{'OL'===a.tagName&&w(a,b,c,d),'TR'===a.tagName&&x(a,b,c,d),e(a,b,c,d)},C=()=>{const a=m;m=c();const b=t(a.path,B);return m.setPath(b),m},D=()=>(C(),m.currentElement),E=(a,b)=>{b.appendChild(a),!u()&&q()&&(m.suppressErrors=!0,C())},F=async a=>{const b=m.currentElement;let c=await r(a,b,D,o);!c&&1<m.path.length&&(s(m,C,f),c=await r(a,b,D,o)),c||E(a,m.currentElement)},G=async a=>{let b=await p(a,m.currentElement,o);b||u()||(s(m,C,f),b=await p(a,m.currentElement,o)),b||E(a,m.currentElement)},H=a=>{const b=a.querySelector('img');return!b&&!l(a)};let I;const J=async a=>{if(m.currentElement.appendChild(a),m.path.push(a),H(a)&&!o())return m.path.pop();const b=[...a.childNodes];a.innerHTML='',o()&&!u()&&q()&&s(m,C,f);const c=f(a)&&!n(a);for(const e of b)d(e)?await(c?F:G)(e):i(e)&&(await I(e));return m.path.pop()};return I=async a=>{if(h(a)){const b=await v(a);k(b)}g(a,C);const b=await J(a);j(b,C)},I(b)},a}({});
//# sourceMappingURL=regionize.min.js.map
